<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kofile — Vendor Tour Request</title>
  <style>
    :root {
      --bg: #0d1117;
      --panel: #161b22;
      --border: #30363d;
      --text: #c9d1d9;
      --muted: #8b949e;
      --accent: #3b82f6;
      --ok: #22c55e;
      --err: #ef4444;
    }
    * { box-sizing: border-box; }
    html,body { height:100%; background:var(--bg); color:var(--text); font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    a { color: var(--accent); }
    .wrap { max-width: 880px; margin: 48px auto; padding: 0 20px; }
    header { margin-bottom: 20px; }
    h1 { margin: 0 0 6px; font-size: 28px; }
    .sub { color: var(--muted); }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.02);
    }

    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .row-1 { grid-column: 1 / -1; }
    label { display:block; font-weight:600; margin: 2px 0 8px; }
    input, textarea, select {
      width: 100%;
      background: #0b1220;
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 14px;
      outline: none;
      transition: border-color .15s ease, box-shadow .15s ease;
    }
    input:focus, textarea:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59,130,246,.25);
    }
    textarea { min-height: 110px; resize: vertical; }

    .actions {
      grid-column: 1 / -1;
      display:flex; gap:12px; align-items:center; justify-content:flex-end;
      margin-top: 4px;
    }
    button {
      background: linear-gradient(90deg, #2563eb, #3b82f6);
      color: white;
      border: none;
      padding: 12px 18px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: .2px;
      transition: transform .06s ease, filter .2s ease;
    }
    button:hover { filter: brightness(1.05); }
    button:active { transform: translateY(1px); }
    .ghost { background: transparent; border:1px solid var(--border); color: var(--text); }

    .status {
      grid-column: 1 / -1;
      margin-top: 8px;
      border-radius: 10px;
      padding: 12px 14px;
      background: #0b1220;
      border: 1px solid var(--border);
      color: var(--muted);
      display:none;
    }
    .status.ok   { display:block; border-color: rgba(34,197,94,.35); color:#a7f3d0; background: rgba(34,197,94,.08); }
    .status.err  { display:block; border-color: rgba(239,68,68,.35); color:#fecaca; background: rgba(239,68,68,.08); }
    .status.info { display:block; border-color: rgba(59,130,246,.35); color:#bfdbfe; background: rgba(59,130,246,.08); }

    footer { margin-top: 22px; color: var(--muted); text-align:center; font-size: 13px; }
    .hint { font-size:12px; color: var(--muted); margin-top:6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Request a Vendor Tour</h1>
      <div class="sub">Submit your details — our team will review and confirm your booking.</div>
    </header>

    <section class="card">
      <form id="tourForm" novalidate>
        <div class="row-1">
          <label for="company">Company</label>
          <input id="company" name="company" autocomplete="organization" required />
        </div>

        <div>
          <label for="requesterName">Requester name</label>
          <input id="requesterName" name="requesterName" autocomplete="name" required />
        </div>

        <div>
          <label for="requesterEmail">Requester email</label>
          <input id="requesterEmail" name="requesterEmail" type="email" autocomplete="email" required />
        </div>

        <div>
          <label for="start">Preferred start (local)</label>
          <input id="start" name="start" type="datetime-local" required />
          <div class="hint">We’ll convert this to UTC automatically.</div>
        </div>

        <div>
          <label for="end">Preferred end (local)</label>
          <input id="end" name="end" type="datetime-local" required />
        </div>

        <div>
          <label for="partySize">Party size</label>
          <input id="partySize" name="partySize" type="number" min="1" step="1" required value="1" />
        </div>

        <div class="row-1">
          <label for="reason">Notes / reason</label>
          <textarea id="reason" name="reason" placeholder="Share any context or requirements…"></textarea>
        </div>

        <div id="status" class="status"></div>

        <div class="actions">
          <button type="button" class="ghost" id="resetBtn">Reset</button>
          <button type="submit" id="submitBtn">Submit request</button>
        </div>
      </form>
    </section>

    <footer>© Kofile</footer>
  </div>

  <script>
    // ====== CONFIG ======
    // Quick path (Option A): direct to existing "book" function (includes function key).
    const ENDPOINT = "https://tourscheduler-api-sbx-bqbuhyd9b2fwgwbz.centralus-01.azurewebsites.net/api/submitTour";


    // Later (recommended): switch to your proxy, e.g.
    // const ENDPOINT = "https://tourscheduler-api-sbx-bqbuhyd9b2fwgwbz.centralus-01.azurewebsites.net/api/submitTour";

    const form = document.getElementById('tourForm');
    const statusEl = document.getElementById('status');
    const resetBtn = document.getElementById('resetBtn');
    const submitBtn = document.getElementById('submitBtn');

    function toUtcIso(local) {
      // Accepts "yyyy-MM-ddTHH:mm" (from datetime-local) and returns UTC ISO with 'Z'
      if (!local) return '';
      const d = new Date(local);
      // If the browser fails to parse, return empty to trigger validation
      if (isNaN(d.getTime())) return '';
      return new Date(d.getTime() - d.getTimezoneOffset()*60000).toISOString().replace(/\.\d{3}Z$/, 'Z');
    }

    function show(msg, cls='info') {
      statusEl.textContent = msg;
      statusEl.className = 'status ' + cls;
    }

    resetBtn.addEventListener('click', () => {
      form.reset();
      statusEl.className = 'status';
      statusEl.textContent = '';
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const company        = document.getElementById('company').value.trim();
      const requesterName  = document.getElementById('requesterName').value.trim();
      const requesterEmail = document.getElementById('requesterEmail').value.trim();
      const startUtc       = toUtcIso(document.getElementById('start').value);
      const endUtc         = toUtcIso(document.getElementById('end').value);
      const partySize      = document.getElementById('partySize').value.trim();
      const reason         = document.getElementById('reason').value.trim();

      // Basic guard
      if (!company || !requesterName || !requesterEmail || !startUtc || !endUtc) {
        show('Please fill all required fields (Company, Requester, Email, Start, End).', 'err');
        return;
      }

      submitBtn.disabled = true;
      show('Submitting…', 'info');

      try {
        const res = await fetch(ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            company,
            requesterName,
            requesterEmail,
            startUtc,
            endUtc,
            partySize,
            reason
          })
        });

        let text = await res.text();
        let data;
        try { data = JSON.parse(text); } catch { data = { message: text }; }

        if (!res.ok) {
          show(`Oops: ${data.message || res.statusText || 'Request failed'}`, 'err');
        } else {
          show(data.message || 'Request received. We’ll email you once it’s scheduled.', 'ok');
          form.reset();
        }
      } catch (err) {
        show(`Network error: ${err.message}`, 'err');
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
